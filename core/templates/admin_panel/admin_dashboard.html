{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  

  <div class="dashboard-grid">
  <!-- USERS: Upper Left -->
    <div class="card"> <!-- USERS -->
      <div class="card-body">
        <h5>Manage Users</h5>
        <p>Create, edit, and delete users.</p>
        <div class="button-group">
          <a href="{% url 'admin_user_list' %}" class="btn-primary">Manage Users</a>
        </div>
      </div>
    </div>

    <!-- EVENTS: Upper Middle -->
    <div class="card"> <!-- EVENTS -->
      <div class="card-body">
        <h5>Manage Events</h5>
        <p>Create, edit, and delete events.</p>
        <div class="button-group">
          <a href="{% url 'admin_event_list' %}" class="btn-primary">Manage Events</a>
        </div>
      </div>
    </div>

    <!-- PROFILE: Upper Right -->
    <div class="card card-wide">
      <div class="card-body">
        <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'images/default_profile.png' %}{% endif %}" alt="Profile Picture" class="profile-picture">

        <div class="profile-info">
          <h5>{{ user.full_name }}</h5>
          <p>Username: {{ user.username }}</p>
          <p class="muted">Administrator</p>
          <a href="#" data-open-modal="#adminProfileModal" data-edit-url="{% url 'admin_profile' %}" class="btn-outline">View Profile</a>
        </div>
      </div>
    </div>

    <!-- UPDATES: Lower Left -->
    <div class="card"> <!-- UPDATES -->
      <div class="card-body">
        <h5>Manage Updates</h5>
        <p>Create, edit, and delete updates.</p>
        <div class="button-group">
          <a href="{% url 'admin_updates_list' %}" class="btn-primary">Manage Updates</a>
        </div>
      </div>
    </div>

    <!-- FORUM: Lower Middle -->
    <div class="card"> <!-- FORUM -->
      <div class="card-body">
        <h5>Manage Forum</h5>
        <p>Post to forum and delete posts.</p>
        <div class="button-group">
          <a href="{% url 'admin_forum_list' %}" class="btn-primary">Manage Posts</a>
        </div>
      </div>
    </div>

    <!-- CHART: Lower Right -->
    <div class="card card-wide-tall"> <!-- CHART -->
      <div class="card-body center-text">
        <h5>Alumni Distribution</h5>
        
        <div class="chart-toggle-links" style="margin-bottom: 10px;">
          <a class="by-degree" href="javascript:void(0);" onclick="showChart('pie')">By Degree</a>
          <a class="by-year" href="javascript:void(0);" onclick="showChart('bar')">By Year</a>
        </div>

        <canvas id="alumniPieChart" width="300" height="300"></canvas>
        <canvas id="alumniBarChart" width="300" height="300" style="display: none;"></canvas>
      </div>
    </div>


    {{ course_data|json_script:"course-data" }}
    {{ yearly_data|json_script:"yearly-data" }}


{{ course_data|json_script:"course-data" }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const pieCtx = document.getElementById('alumniPieChart').getContext('2d');
  const barCtx = document.getElementById('alumniBarChart').getContext('2d');

  const pieData = JSON.parse(document.getElementById('course-data').textContent);
  const barData = JSON.parse(document.getElementById('yearly-data').textContent);

  const pieChart = new Chart(pieCtx, {
    type: 'pie',
    data: {
      labels: ['IT Alumni', 'CS Alumni', 'ACT Alumni', 'EMC Alumni'],
      datasets: [{
        data: [pieData.BSIT, pieData.BSCS, pieData.ACT, pieData.BSEMC],
        backgroundColor: ['#F4EAFE', '#B99DF3', '#D6AEF7', '#7E55CC'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'bottom' } }
    }
  });

  const years = barData.map(item => item.year);
  const barChart = new Chart(barCtx, {
    type: 'bar',
    data: {
      labels: years,
      datasets: [
        {
          label: 'BSIT',
          data: barData.map(item => item.BSIT),
        },
        {
          label: 'BSCS',
          data: barData.map(item => item.BSCS),
        },
        {
          label: 'ACT',
          data: barData.map(item => item.ACT),
        },
        {
          label: 'BSEMC',
          data: barData.map(item => item.BSEMC),
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      },
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });

  window.showChart = function(type) {
    document.getElementById('alumniPieChart').style.display = (type === 'pie') ? 'block' : 'none';
    document.getElementById('alumniBarChart').style.display = (type === 'bar') ? 'block' : 'none';
  };
});
</script>

{% endblock %}

