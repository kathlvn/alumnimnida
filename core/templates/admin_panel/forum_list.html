{% extends 'base.html' %}
{% block content %}

<h2>Forum Posts</h2>

<form method="get" style="margin-bottom: 20px;">
    <input type="text" name="q" placeholder="Search posts or authors" value="{{ query }}" />
    <button type="submit">Search</button>
</form>

{% for post in posts %}
<div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 20px;">
    <strong>{{ post.author.get_full_name }}</strong> |
    {{ post.date_posted|date:"M d, Y H:i" }}
    <p>{{ post.title }}</p>
    <p>{{ post.content }}</p>

    <form method="post" action="{% url 'admin_delete_post' post.id %}" onsubmit="return confirm('Are you sure you want to delete this post? This cannot be undone.');" style="display:inline;">
        {% csrf_token %}
        <button type="submit" style="color:red;">Delete</button>
    </form>

    <div style="margin-top:10px; padding-left: 15px;">
        <strong>Comments:</strong>
        {% for comment in post.comments.all %}
            <div style="margin-top: 5px; border-left: 2px solid #ccc; padding-left: 10px;">
                <small><strong>{{ comment.user.get_full_name }}</strong> |
                {{ comment.date_posted|date:"M d, Y H:i" }}</small>
                <p>{{ comment.content }}</p>
            </div>
        {% empty %}
            <p><i>No comments yet.</i></p>
        {% endfor %}
    </div>
</div>
{% empty %}
<p>No forum posts available.</p>
{% endfor %}

{% endblock %}
