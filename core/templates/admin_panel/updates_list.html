{% extends 'base.html' %}
{% load static %}

{% block title %}Manage Updates{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/updates_list.css' %}">
{% endblock %}

{% block content %}
<div class="admin-container p-4 bg-light text-dark">
  <h1 class="mb-4">Manage Updates</h1>

  <form method="get" class="mb-3 d-flex" role="search">
    <input type="text" name="q" value="{{ query }}" class="form-control me-2" placeholder="Search updates...">
    <button type="submit" class="btn btn-outline-primary">Search</button>
  </form>

  <a href="{% url 'admin_updates_create' %}" class="btn btn-primary mb-3">Add New Update</a>

  <table class="table table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th>Title</th>
        <th>Related Event</th>
        <th>Date Posted</th>
        <th>Visibility</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for update in updates %}
      <tr>
        <td>{{ update.title }}</td>
        <td>
          {% if update.related_event %}
            {{ update.related_event.title }}
          {% else %}
            <em>No related event</em>
          {% endif %}
        </td>
        <td>{{ update.date_posted|date:"Y-m-d H:i" }}</td>
        <td>
          <strong>{{ update.get_visibility_type_display }}</strong><br>
          {% if update.visibility_type == "batch" or update.visibility_type == "both" %}
            <span>
              {% for batch in update.visibility_batches.all %}
                {{ batch.year }}{% if not forloop.last %}, {% endif %}
              {% empty %}None{% endfor %}
            </span>
          {% endif %}
          {% if update.visibility_type == "degree" or update.visibility_type == "both" %}
            <span>
              {% for degree in update.visibility_degrees.all %}
                {{ degree.code }}{% if not forloop.last %}, {% endif %}
              {% empty %}None{% endfor %}
            </span>
          {% endif %}
        </td>
        <td>
          <a href="{% url 'admin_updates_edit' update.id %}" class="btn btn-sm btn-warning">Edit</a>
          <a href="{% url 'admin_updates_delete' update.id %}" class="btn btn-sm btn-danger"
             onclick="return confirm('Are you sure you want to delete this update?');">Delete</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center text-muted">No updates available.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="pagination">
    <span class="page-info">SHOWING PAGE {{ page_obj.number }} OF {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}" class="page-link">Previous</a>
    {% endif %}

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}" class="page-link">Next</a>
    {% endif %}
  </div>
  
</div>
{% endblock %}
