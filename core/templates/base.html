{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Alumni System{% endblock %}</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  {% block extra_css %}{% endblock %}
</head>
<body>

  {% if request.user.is_authenticated %}
    {% if request.user.is_staff %}
      <!-- Admin Layout with Header Left and Navigation Right -->
      <div class="header">
        <img src="{% static 'img/ccs_logo.png' %}" alt="CCS Logo" class="logo-img">
        <div class="header-text">
          <h1>DEPARTMENT OF COMPUTER STUDIES</h1>
          <p>ALUMNI TRACKING AND ENGAGEMENT MANAGEMENT SYSTEM</p>
        </div>
        <div class="admin-nav">
          <nav>
            <a href="{% url 'admin_dashboard' %}" title="Home">
              <img src="{% static 'img/home_icon.png' %}" alt="Home">
            </a>
            <a href="{% url 'admin_user_list' %}" title="Users">
              <img src="{% static 'img/user_icon.png' %}" alt="Users">
            </a>
            <a href="{% url 'admin_event_list' %}" title="Events">
              <img src="{% static 'img/events_icon.png' %}" alt="Events">
            </a>
            <a href="{% url 'admin_updates_list' %}" title="Updates">
              <img src="{% static 'img/updates_icon.png' %}" alt="Updates">
            </a>
            <a href="{% url 'admin_forum_list' %}" title="Forum">
              <img src="{% static 'img/forum_icon.png' %}" alt="Forum">
            </a>
            <a href="{% url 'logout' %}" title="Logout" class="logout-link">
              <img src="{% static 'img/logout_icon.png' %}" alt="Logout">
            </a>
          </nav>
        </div>
      </div>
    {% else %}
      <!-- User Header Bar -->
      <div class="header">
        <img src="{% static 'img/ccs_logo.png' %}" alt="CCS Logo" class="logo-img">
        <div class="header-text">
          <h1>DEPARTMENT OF COMPUTER STUDIES</h1>
          <p>ALUMNI TRACKING AND ENGAGEMENT MANAGEMENT SYSTEM</p>
        </div>
      </div>

    {% endif %}
  {% endif %}

  <div class="{% if request.user.is_authenticated and request.user.is_staff %}admin-container{% else %}container{% endif %}">

    {% if request.user.is_authenticated and not request.user.is_staff %}
      <!-- Sidebar for Regular Users -->
      <div class="sidebar">
        <nav>
          <a href="{% url 'profile' %}" title="Profile"><img src="{% static 'img/user_icon.png' %}" alt="Profile"></a>
          <a href="{% url 'home' %}" title="Home"><img src="{% static 'img/home_icon.png' %}" alt="Home"></a>
          <a href="{% url 'forum' %}" title="Forum"><img src="{% static 'img/forum_icon.png' %}" alt="Forum"></a>
          <a href="{% url 'events' %}" title="Events"><img src="{% static 'img/events_icon.png' %}" alt="Events"></a>
          <a href="{% url 'updates' %}" title="Updates"><img src="{% static 'img/updates_icon.png' %}" alt="Updates"></a>
          <a href="{% url 'logout' %}" title="Logout" class="logout-link"><img src="{% static 'img/logout_icon.png' %}" alt="Logout"></a>
        </nav>
      </div>
    {% endif %}

    <!-- Main Content Area -->
    <div class="main-content">
      {% if not request.user.is_staff %}
        <div class="global-header">
          <h1 class="page-title">{% block page_title %}{% endblock %}</h1>
          <form method="get" action="{% url 'global_search' %}">
            <input type="text" name="q" class="search-bar" placeholder="Search...">
          </form>
        </div>
      {% endif %}
      {% block content %}{% endblock %}
    </div>

    {% if not request.user.is_staff %}
      <!-- Right Panel for Regular Users -->
      <div class="right-panel">
        {% block right_panel %}{% endblock %}
      </div>
    {% endif %}
  </div>

    <!-- A fixed backdrop used to blur/dim the page when any modal is open. It's placed
      outside of `.main-content` so we avoid applying CSS `filter` to parents. -->
    <div id="modal-backdrop" aria-hidden="true"></div>
    {% block modal %}
      {% if request.user.is_authenticated and request.user.is_staff %}
        {% include 'admin_panel/form_modals.html' %}
      {% endif %}
      <!-- Shared detail modal used by search results and other pages. -->
      <div id="detailModal" class="modal-overlay" role="dialog" aria-hidden="true" style="display:none;">
        <div class="modal-card" role="document">
          <button type="button" class="close-btn" aria-label="Close" id="detail-modal-close">&times;</button>
          <div id="detail-modal-body" class="detail-modal-body">
            <!-- AJAX-injected detail HTML appears here -->
          </div>
        </div>
      </div>
    {% endblock %}

    
  <!-- Logout confirmation modal (namespaced classes) -->
  <div id="logoutModal" class="logout-modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="logout-modal-box" role="document">
      <h3>Confirm Logout</h3>
      <p>Are you sure you want to logout?</p>
      <div class="logout-modal-actions">
          <button type="button" class="logout-cancel">Cancel</button>
          <button type="button" class="logout-confirm">Yes, logout</button>
      </div>
    </div>
  </div>
  {% block extra_js %}{% endblock %}
  {% block scripts %}{% endblock %}

  {% comment %} Logout modal JS is moved to static file {% endcomment %}
  {% load static %}
  <script src="{% static 'js/logout-modal.js' %}"></script>
  <script src="{% static 'js/modal-focus-blur.js' %}"></script>
  <script>
    // Close/open helpers for the shared detail modal
    (function(){
      function closeDetailModal(){
        var modal = document.getElementById('detailModal');
        if(!modal) return;
        modal.style.display = 'none';
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden','true');
        document.body.classList.remove('modal-opened');
        var body = document.getElementById('detail-modal-body');
        if(body) body.innerHTML = '';
      }

      function openDetailModal(){
        var modal = document.getElementById('detailModal');
        if(!modal) return;
        modal.style.display = 'flex';
        modal.classList.add('open');
        modal.setAttribute('aria-hidden','false');
        document.body.classList.add('modal-opened');
      }

      document.addEventListener('click', function(e){
        var modal = document.getElementById('detailModal');
        if(!modal) return;
        // close when clicking backdrop
        if(e.target === modal){
          closeDetailModal();
        }
      });

      var closeBtn = document.getElementById('detail-modal-close');
      if(closeBtn){ closeBtn.addEventListener('click', closeDetailModal); }

      document.addEventListener('keydown', function(e){
        if(e.key === 'Escape') closeDetailModal();
      });

      // Expose helpers for pages that set modal content
      window.__detailModal = { open: openDetailModal, close: closeDetailModal };
    })();
  </script>
</body>
</html>
