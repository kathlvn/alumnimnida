{% extends "base.html" %}
{% load static %}

{% block title %}Updates{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/updates.css' %}">
{% endblock %}

{% block page_title %}UPDATES{% endblock %}

{% block content %}
<div class="content-wrapper">
  <div class="updates-section">
    <div class="top-row">
    <form method="get" class="filter-form">
      <label for="visibility">Filter by:</label>
      <select name="visibility" id="visibility" onchange="this.form.submit()">
        <option value="" {% if not visibility_filter %}selected{% endif %}>All</option>
        <option value="public" {% if visibility_filter == 'public' %}selected{% endif %}>Public</option>
        <option value="batch" {% if visibility_filter == 'batch' %}selected{% endif %}>By Batch</option>
        <option value="degree" {% if visibility_filter == 'degree' %}selected{% endif %}>By Degree</option>
      </select>
    </form>
  </div>

    {% for update in updates %}
    <div class="update-box" onclick="openModal('{{ update.id }}')">
      <h3 class="update-title">{{ update.title }}</h3>
      <p class="update-desc">{{ update.content }}</p>
      <p class="update-date">
        <em><strong>Posted on {{ update.date_posted|date:"F d, Y, g:i A" }}</strong></em>
      </p>
    </div>

      <!-- Modal placed right after each update box -->
    <div id="modal-{{ update.id }}" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('{{ update.id }}')">&times;</span>
        <h2>{{ update.title }}</h2>
        <p>{{ update.content }}</p>
        <p><strong>Posted:</strong> {{ update.date_posted|date:"F d, Y, g:i A" }}</p>
      </div>
    </div>
    {% empty %}
    <p>No updates available.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}


{% block right_panel %}
<div class="quick-stats">
  <h3 class="timeline-title">Recent Updates Timeline</h3>
  <ul>
    {% for recent in recent_updates %}
    <li><strong>{{ recent.date_posted|date:"F d, Y" }}:</strong> {{ recent.title }}</li>
    {% empty %}
    <li>No recent updates available.</li>
    {% endfor %}
  </ul>
</div>
{% endblock %}

{% block scripts %}
<script>
  function openModal(id) {
    document.getElementById("modal-" + id).style.display = "block";
  }
  function closeModal(id) {
    document.getElementById("modal-" + id).style.display = "none";
  }
</script>
{% endblock %}
