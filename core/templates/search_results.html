{% extends 'base.html' %}
{% load static %}
{% block content %}
  <h2>Search Results for "{{ query }}"</h2>

  {% if users or admins or events or updates or forums %}
    {% if users %}
      <h4>Users</h4>
      <ul>
        {% for user in users %}
          <li>
            <a href="#" class="search-result-link" data-url="{% url 'user_profile' user.pk %}">
              {{ user.student_number }} - {{ user.full_name }}
            </a>
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    {% if admins %}
      <h4>Admins</h4>
      <ul>
        {% for admin in admins %}
          <li>
            <a href="#" class="search-result-link" data-url="{% url 'user_profile' admin.pk %}">
              {{ admin.full_name }} ({{ admin.username }})
            </a>
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    {% if events %}
      <h4>Events</h4>
      <ul>
        {% for event in events %}
          <li>
            <a href="#" class="search-result-link" data-url="{% url 'event_detail' event.pk %}">{{ event.title }}</a>
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    {% if updates %}
      <h4>Updates</h4>
      <ul>
        {% for update in updates %}
          <li>
            <a href="#" class="search-result-link" data-url="{% url 'update_detail' update.pk %}">{{ update.title }}</a>
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    {% if forums %}
      <h4>Forum Posts</h4>
      <ul>
        {% for forum in forums %}
          <li>
            <a href="#" class="search-result-link" data-url="{% url 'forum_detail' forum.pk %}">{{ forum.title }} by {{ forum.author.full_name }}</a>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  {% else %}
    <p>No results found.</p>
  {% endif %}

  {% endblock %}

{% block extra_js %}
<script>
  function openDetailModalWithHTML(html){
    const modal = document.getElementById('detailModal');
    const body = document.getElementById('detail-modal-body');
    if(!modal || !body) return;
    body.innerHTML = html;
    modal.classList.add('open');
    modal.setAttribute('aria-hidden','false');
    document.body.classList.add('modal-opened');
  }

  function loadSearchDetail(url){
    const body = document.getElementById('detail-modal-body');
    if(body) body.innerHTML = '<p>Loading...</p>';
    fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' }, credentials: 'same-origin' })
      .then(r => { if(!r.ok) throw new Error('Failed to load'); return r.text(); })
      .then(html => openDetailModalWithHTML(html))
      .catch(() => openDetailModalWithHTML('<p>Error loading detail view.</p>'));
  }

  document.addEventListener('DOMContentLoaded', function(){
    document.querySelectorAll('.search-result-link').forEach(function(link){
      link.addEventListener('click', function(e){
        e.preventDefault();
        const url = this.getAttribute('data-url');
        if(!url) return;
        loadSearchDetail(url);
      });
    });
  });
</script>
{% endblock %}

{% block extra_css %}
<style>
/* 
  .modal-overlay {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.8);
}

.modal-card {
  background-color: #2a003f;
  position: relative;
  margin: 10% auto;
  padding: 20px;
  border: 2px solid white;
  width: 60%;
  color: white;
  border-radius: 20px;
  box-shadow: 0 8px 20px rgba(255, 255, 255, 0.1);
} */

  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(0,0,0,0.8);
  }

  .modal-card {
    box-shadow: 0 8px 20px rgba(255, 255, 255, 0.1);
    background-color: #2a003f;
    color: rgb(251, 250, 253);
    border: 2px solid white;
    border-radius: 10px;
    padding: 20px 50px;
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
  }

  .close-btn {
    position: absolute;
    top: 10px;
    right: 20px;
    font-size: 24px;
    cursor: pointer;
  }
</style>
{% endblock %}
